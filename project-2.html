<!DOCTYPE HTML>

<html>
	<head>
		<title>PROJECT 2</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
    .hidden {
        display: none; /* Initially hides the sections */
    }
    .toggle-button {
        display: inline-block;
        margin: 10px 0;
        padding: 0px 20px;
        background-color: transparent;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 5px;
    }
    .toggle-button:hover {
        background-color: #0056b3;
    }
    .section {
        padding: 10px;
        border: 1px solid #ddd;
        margin: 10px 0;
    }
</style>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">

							<!-- Header -->
								<header id="header">
									<a href="index.html" class="logo">Project<strong> 2</strong></a>
								</header>

							<!-- Content -->
								<section>
									<header class="main">
										<h1>Flood Level Monitoring</h1>
									</header>
                        <!-- Main Image (pic11.jpg) -->
                        <span class="image fit">
                            <a href="images/2.jpg" class="image-link"><img src="images/2.jpg" alt="" /></a>
                        </span>


                        <!-- Modal Dialog -->
                        <div id="modal" class="modal">
                            <span class="close">&times;</span>
                            <img class="modal-content" id="modal-image">
                        </div>

                        <!-- JavaScript to Show Full Image on Click -->
                        <script>
                            // Get all elements with class "image-link"
                            const imageLinks = document.querySelectorAll('.image-link');

                            // Get the modal element
                            const modal = document.getElementById('modal');

                            // Get the image element within the modal
                            const modalImg = document.getElementById('modal-image');

                            // Loop through each image link
                            imageLinks.forEach(link => {
                                link.addEventListener('click', function(event) {
                                    event.preventDefault(); // Prevent default link behavior

                                    // Get href attribute of the clicked link (full-size image URL)
                                    const imageURL = this.getAttribute('href');

                                    // Display the modal
                                    modal.style.display = 'flex'; // Show the modal as flexbox for centering

                                    // Set the clicked image as the source of the modal image
                                    modalImg.src = imageURL;

                                    // Reset modal content position
                                    modal.scrollTop = 0;
                                    modal.scrollLeft = 0;
                                });
                            });

                            // Close the modal when the close button (x) is clicked
                            const closeBtn = document.querySelector('.close');
                            closeBtn.addEventListener('click', function() {
                                modal.style.display = 'none';
                            });

                            // Close the modal when clicking outside of it
                            window.addEventListener('click', function(event) {
                                if (event.target === modal) {
                                    modal.style.display = 'none';
                                }
                            });

                            // Enable zoom functionality
                            modalImg.addEventListener('click', function() {
                                if (modalImg.classList.contains('zoomed')) {
                                    modalImg.classList.remove('zoomed');
                                } else {
                                    modalImg.classList.add('zoomed');
                                }
                            });
                        </script>
									<!-- Content -->
										<h2 id="content">HOW IT WORKS?</h2>
										<p>In this flood level monitoring project, a room occupancy module is employed which consists of ultrasonic sensor. This particular type of sensor generate ultrasonic wave which in turn reflect off any objects near to the sensor. The time base sensor measures the time that sound waves take in travelling to the water surface and back. <br><br>In the case of water level change, the sensor is programmed detects this by signaling the Main Board when water level gets close to a certain predefined level. The addition of the ultrasonic sensor facilitates monitoring of water levels in the different areas to be done without having to make physical contact with the water.</p>
										<h2 id="content">PARTS NEEDED:</h2>
										<p>• Main Board Module<br>
										• Motion Module<br>
										• Connector Cable <br></p>

								<section>
									<header class="main">
										<h2 id="content">SENSOR USED IN THE MODULE</h2></header>
										<p><strong>HC-SR04 Ultrasonic Sensor</strong><br> This module is employed in the project in such a manner that it produces sound vibrations which propagate in the atmosphere to the surface of the water. The sensor calculates the travelled time of the sound waves and determine the distance to the water through the speed of the sound. This distance reduces as the water level increases. <br><br>The sensor is always observing such a change and passing real-time information to the Main Board to generate an alarm or notification when it approaches a predetermined level. This non-invasive method enables the achievement of correct and consistent identification of water levels required for flood identification.</p>
								</section>

						<!-- Image Section -->
						<h2>THE BUILD</h2>

						<!-- Main Image (pic11.jpg) -->
						<span class="image fit">
						    <a href="images/sflood.jpg" class="image-link"><img src="images/sflood.jpg" alt="" /></a>
						</span>

						<!-- Modal Dialog -->
						<div id="modal" class="modal">
						    <span class="close">&times;</span>
						    <img class="modal-content" id="modal-image">
						</div>

						<!-- JavaScript to Show Full Image on Click -->
						<script>
						    // Get all elements with class "image-link"
						    const imageLinks = document.querySelectorAll('.image-link');

						    // Get the modal element
						    const modal = document.getElementById('modal');

						    // Get the image element within the modal
						    const modalImg = document.getElementById('modal-image');

						    // Loop through each image link
						    imageLinks.forEach(link => {
						        link.addEventListener('click', function(event) {
						            event.preventDefault(); // Prevent default link behavior

						            // Get href attribute of the clicked link (full-size image URL)
						            const imageURL = this.getAttribute('href');

						            // Display the modal
						            modal.style.display = 'flex'; // Show the modal as flexbox for centering

						            // Set the clicked image as the source of the modal image
						            modalImg.src = imageURL;

						            // Reset modal content position
						            modal.scrollTop = 0;
						            modal.scrollLeft = 0;
						        });
						    });

						    // Close the modal when the close button (x) is clicked
						    const closeBtn = document.querySelector('.close');
						    closeBtn.addEventListener('click', function() {
						        modal.style.display = 'none';
						    });

						    // Close the modal when clicking outside of it
						    window.addEventListener('click', function(event) {
						        if (event.target === modal) {
						            modal.style.display = 'none';
						        }
						    });

						    // Enable zoom functionality
						    modalImg.addEventListener('click', function() {
						        if (modalImg.classList.contains('zoomed')) {
						            modalImg.classList.remove('zoomed');
						        } else {
						            modalImg.classList.add('zoomed');
						        }
						    });
						</script>

<h2>CHOOSE WHAT PROJECT YOU WISH TO PERFORM"</h2>
<!-- Button for Set 1 -->
<button id="toggleSet1" class="toggle-button">Through the Internet</button>
<!-- Section 1 -->
<div id="set1" class="hidden">
    <div class="section">
        <h2>Instructions</h2>
<p><strong>Step 1: Assembling the System</strong><br>
<strong>Positioning the Module:</strong><br>
1. Take the Motion Module (enclosed in the 3D-printed box) and align it over the main board.<br>
2. Gently press the module onto the main board's connector pins until it fits securely in place.<br>   
3. Ensure that the module is correctly seated to avoid loose connections.<p>
<strong>Step 2: Powering the System</strong><br>
<strong>Connecting Power:</strong><br>
1. Get the connecting cable and attach it into the laptop that you will use to upload the code.<br>
2. Plug in the other end of it to the main board. The system will automatically power on.<br>
<strong>Visual Indicator Check:</strong><br>
Observe the LED indicators on the main board. The system should show a steady power LED to confirm it's operational.<p>
<strong>Step 3: Connecting to the Internet and Adafruit IO:</strong><br>
1. Copy the code in the website under "Through Internet" then change the WiFi SSID and password depending on what connection you wish to connect.
2. Open Adafruit IO in your search engine then use "IoTTrainingBoard@gmail.com" as email and "IoT92934." as password.
3. Select Project 2 in the dashboard. <p>
<strong>Testing the Alerts:</strong><br>
To test the system, place you palm in front of the sensor. The alerts should activate.
                            </p>

<!-- Video Button -->
<button id="showVideoButton">Watch Video Instruction</button>

<!-- Video Modal -->
<div id="videoModal" class="modal">
    <span class="close" id="closeVideo">&times;</span>
    <div class="video-container">
        <video id="videoPlayer" controls>
            <source src="vmotion.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>

<!-- CSS for Styling -->
<style>
    /* Video Button */
    #showVideoButton {
        display: block;
        margin: 20px auto;
        padding: 1px 5px;
        background-color: transparent;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 12px;
    }

    /* Video Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
    }

    .video-container {
        width: 80%;
        max-width: 600px;
    }

    .close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 2rem;
        color: white;
        cursor: pointer;
    }

    video {
        width: 100%;
        height: auto;
        border: none;
    }
</style>

<!-- JavaScript for Modal Functionality -->
<script>
    // Get the elements
    const showVideoButton = document.getElementById("showVideoButton");
    const videoModal = document.getElementById("videoModal");
    const closeVideo = document.getElementById("closeVideo");
    const videoPlayer = document.getElementById("videoPlayer");

    // Show modal when button is clicked
    showVideoButton.addEventListener("click", function() {
        videoModal.style.display = "flex";
        videoPlayer.play(); // Auto-play video when modal is shown
    });

    // Close modal when the close button is clicked
    closeVideo.addEventListener("click", function() {
        videoModal.style.display = "none";
        videoPlayer.pause(); // Pause video when modal is closed
        videoPlayer.currentTime = 0; // Reset video to start
    });

    // Close modal when clicking outside the video
    window.addEventListener("click", function(event) {
        if (event.target === videoModal) {
            videoModal.style.display = "none";
            videoPlayer.pause(); // Pause video when modal is closed
            videoPlayer.currentTime = 0; // Reset video to start
        }
    });
</script>
    </div>
    <div class="section">
        <h2>Code</h2>
        <pre><code>#include &lt;WiFi.h&gt;
#include "AdafruitIO_WiFi.h"

// Adafruit IO credentials
#define IO_USERNAME "IoTTrainingBoard"
#define IO_KEY "aio_lYXr89c05NCpeRgnLIeYJuSGcjby"

// WiFi credentials
#define WIFI_SSID "PLDTHOMEFIBR5e300"
#define WIFI_PASS "SASHuke@1123"

// Adafruit IO instance
AdafruitIO_WiFi io(IO_USERNAME, IO_KEY, WIFI_SSID, WIFI_PASS);

// Feeds for flood monitoring
AdafruitIO_Feed *floodPercentageFeed = io.feed("flood_percentage");
AdafruitIO_Feed *floodLevelFeetFeed = io.feed("flood_level_feet");

// Ultrasonic Sensor Pins
const int trigPin = 5;   // Trig pin for the ultrasonic sensor
const int echoPin = 18;  // Echo pin for the ultrasonic sensor

#define SOUND_SPEED 0.034
long duration;
float distanceCm;
float floodLevel;
float floodLevelFeet;

// Maximum flood level in centimeters
const float maxFloodLevel = 200.0;  // Adjust based on your sensor's maximum measurable distance (e.g., 200 cm)

// Function to read the distance from the ultrasonic sensor
float readFloodLevel() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  
  duration = pulseIn(echoPin, HIGH);
  distanceCm = duration * SOUND_SPEED / 2;  // Convert time to distance in cm

  // Calculate flood level as a percentage (0% = no water, 100% = maximum flood level)
  floodLevel = ((maxFloodLevel - distanceCm) / maxFloodLevel) * 100;
  if (floodLevel &lt; 0) floodLevel = 0;  // Ensure no negative values
  if (floodLevel &gt; 100) floodLevel = 100;  // Ensure it doesn't go beyond 100%

  // Convert distance to feet
  floodLevelFeet = (maxFloodLevel - distanceCm) / 30.48;
  if (floodLevelFeet &lt; 0) floodLevelFeet = 0;  // Ensure no negative values

  return floodLevel;
}

void setup() {
  Serial.begin(115200);

  // Ultrasonic sensor setup
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);

  // Connect to Adafruit IO
  Serial.print("Connecting to Adafruit IO...");
  io.connect();

  // Wait for connection
  while (io.status() &lt; AIO_CONNECTED) {
    Serial.print(".");
    delay(500);
  }
  Serial.println("Connected!");

  // Initialize Adafruit IO feeds
  floodPercentageFeed-&gt;save(0); // Initialize flood percentage
  floodLevelFeetFeed-&gt;save(0);  // Initialize flood level in feet
}

void loop() {
  io.run();  // Keep Adafruit IO connection alive

  // Read and update flood levels
  readFloodLevel();

  // Publish flood level to Adafruit IO
  floodPercentageFeed-&gt;save(floodLevel);
  floodLevelFeetFeed-&gt;save(floodLevelFeet);

  // Debugging logs
  Serial.print("Flood Level Percentage: ");
  Serial.print(floodLevel);
  Serial.println("%");
  
  Serial.print("Flood Level Feet: ");
  Serial.print(floodLevelFeet);
  Serial.println(" ft");

  delay(1000);  // Update every second
}


</code></pre><button id="copyButton">Copy Code</button>
    </div>
    <div class="section">
        <h2>Code Explanation</h2>
   <p>The code sets up a Flood Level Monitoring System using an ultrasonic sensor and an ESP32, creating an Access Point (AP) for users to monitor water levels in real-time. This system calculates flood levels as a percentage and in feet, with data displayed on a web page. Let’s break it down.

    <p><strong>Key Components and Their Roles</strong><br>
<strong>1. Libraries Included:</strong><br>
&emsp;&emsp;&emsp;•<strong><code>WiFi.h</code></strong>Handles Wi-Fi connectivity for the ESP32.<br>
&emsp;&emsp;&emsp;•<strong><code>AdafruitIO_WiFi.h</code></strong>Integrates the ESP32 with Adafruit IO for data feeds and connectivity.<br>
<strong>2. WiFi Setup:</strong><br>
&emsp;&emsp;&emsp;• Configures the ESP32 to connect to a Wi-Fi network using SSID <code>PLDTHOMEFIBR5e300</code> and password <code>SASHuke@1123</code>.<br>
&emsp;&emsp;&emsp;• Establishes an Adafruit IO instance using the username <code>IoTTrainingBoard</code> and key <code>aio_lYXr89c05NCpeRgnLIeYJuSGcjby</code>.<p>

<strong>3. Ultrasonic Sensor Setup:</strong><br>
&emsp;&emsp;&emsp;• The Trig pin of the ultrasonic sensor is connected to GPIO 5, and the Echo pin is connected to GPIO 18.<br>
&emsp;&emsp;&emsp;• The sensor calculates the distance to the water surface using the duration of sound wave reflection.<br>
&emsp;&emsp;&emsp;• The<strong><code>SOUND_SPEED</code></strong>is set to 0.034 cm/μs to calculate the distance accurately.<br>
&emsp;&emsp;&emsp;• The maximum flood level is defined as 200 cm for calculating flood levels.<p>

<div class="button-container">
    <!-- Button to show first image -->
    <button id="showImageButton1" class="show-image-button">Ultrasonic Sensor Pinout</button>

    <!-- Button to show second image -->
    <button id="showImageButton2" class="show-image-button">ESP32 Pinout</button>
</div>

<!-- Hidden first image container -->
<div id="imageContainer1" class="hidden">
    <img src="images/ultrasonic.jpg" alt="Ultrasonic Sensor Image" style="max-width: 100%; height: auto;"><br>
    Photo Credit: The DIY Life<p>
</div>

<!-- Hidden second image container -->
<div id="imageContainer2" class="hidden">
    <img src="images/esp32.jpg" alt="ESP32 Image" style="max-width: 100%; height: auto;"><br>
    Photo Credit: Random Nerd Tutorials<p>
</div>

<!-- JavaScript to handle button clicks for each image -->
<script>
    const showImageButton1 = document.getElementById("showImageButton1");
    const imageContainer1 = document.getElementById("imageContainer1");

    const showImageButton2 = document.getElementById("showImageButton2");
    const imageContainer2 = document.getElementById("imageContainer2");

    // Toggle first image visibility
    showImageButton1.addEventListener("click", function() {
        imageContainer1.classList.toggle("hidden");
    });

    // Toggle second image visibility
    showImageButton2.addEventListener("click", function() {
        imageContainer2.classList.toggle("hidden");
    });
</script>

<!-- CSS for styling -->
<style>
    /* Center the button container */
    .button-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 10px;
    }

    /* Style for buttons */
    .show-image-button {
        padding: 5px 10px;
        background-color: transparent;
        color: #7f888f;
        border: 2px solid #FF6F61;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 30px;
        transition: background-color 0.3s, color 0.3s;
    }

    /* Center text inside the button */
    .show-image-button:hover {
        background-color: rgba(255, 255, 255, 0.2);
        color: #00ab41;
    }

    /* Hide initially */
    .hidden {
        display: none;
    }

    /* Margin for image containers */
    #imageContainer1, #imageContainer2 {
        margin-top: 10px;
    }
</style><p>

<strong>4. Server Functions:</strong><br>
&emsp;&emsp;&emsp;• Key server functions include:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;•<strong><code>readFloodLevel()</code></strong>Reads the distance using the ultrasonic sensor and calculates the flood level as a percentage and in feet.<br>
&emsp;&emsp;&emsp;&emsp;&emsp;• Publishes flood levels to Adafruit IO feeds:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;• <strong><code>floodPercentageFeed</code></strong>: Stores the flood level as a percentage.<br>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;• <strong><code>floodLevelFeetFeed</code></strong>: Stores the flood level in feet.<p>

<strong>5. Data Collection with<code>readFloodLevel()</code>:</strong><br> 
&emsp;&emsp;&emsp;• The function sends a pulse from the Trig pin and calculates the distance based on the Echo pin response.<br>
&emsp;&emsp;&emsp;• Calculates flood level as:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;• Percentage: Relative to the maximum flood level.<br>
&emsp;&emsp;&emsp;&emsp;&emsp;• Feet: Converts the measured distance to feet for additional clarity.<p>

<strong>6. Web Interface Design:</strong><br> 
&emsp;&emsp;&emsp;• Adafruit IO serves as the web interface for displaying flood levels as a percentage and in feet.<br> 
&emsp;&emsp;&emsp;• Data is updated dynamically for real-time monitoring.<p>

<strong>7. JavaScript and AJAX Updates:</strong><br> 
&emsp;&emsp;&emsp;• Adafruit IO provides real-time updates to ensure flood level data is accurate and accessible via the web interface.<br> 
&emsp;&emsp;&emsp;• Users can monitor flood levels remotely through Adafruit IO feeds.<p>

<strong>8. The Setup<code>setup()</code>and Loop<code>loop()</code>Functions:</strong><br> 
&emsp;&emsp;&emsp;•<strong><code>setup()</code></strong>Initializes the ultrasonic sensor pins and connects to Adafruit IO. It also initializes flood level feeds to 0.<br> 
&emsp;&emsp;&emsp;•<strong><code>loop()</code></strong>Runs Adafruit IO's connection, continuously monitors the flood level, and updates the feeds with the calculated data.<p>
    </div>
</div>


<!-- Button for Set 2 -->
<button id="toggleSet2" class="toggle-button">WiFi Direct</button>
<!-- Section 2 -->
<div id="set2" class="hidden">
    <div class="section">
        <h2><strong>Instructions</strong></h2>
<p><strong>Step 1: Assembling the System</strong><br>
<strong>Positioning the Module:</strong><br>
1. Take the Motion Module (enclosed in the 3D-printed box) and align it over the main board.<br>
2. Gently press the module onto the main board's connector pins until it fits securely in place.<br>   
3. Ensure that the module is correctly seated to avoid loose connections.<p>
<strong>Step 2: Powering the System</strong><br>
<strong>Connecting Power:</strong><br>
1. Get the connecting cable and attach it into the laptop that you will use to upload the code.<br>
2. Plug in the other end of it to the main board. The system will automatically power on.<br>
<strong>Visual Indicator Check:</strong><br>
Observe the LED indicators on the main board. The system should show a steady power LED to confirm it's operational.<p>
<strong>Step 3: Connecting to Web Server:</strong><br>
1. Once the serial monitor says "Code Uploaded", open the serial monitor of the Arduino IDE then press the <strong>EN</strong> button to show the IP address.<br>
2. Open your WiFi and look for <strong>ESP32_Flood</strong>. Choose that option and enter password <strong>12345678</strong><be>.
3. Enter the IP address in a search engine <strong>192.168.4.1</strong>. <p>
<strong>Step 4: Monitoring and Alerts</strong><br>
<strong>Understanding the Alerts:</strong><br>
1. The system is equipped with a visual (web server) alert.<br>
2. The web server will show a visual meter reading showing the water level detected by the sensor. It should be noted that to be able to get an accurate reading, the sensor should be placed 6.45 feet above ground.<p>
<strong>Testing the Alerts:</strong><br>
To test the system, place you palm in front of the sensor and move it closer then away. The alerts should activate.
														</p>

<!-- Video Button -->
<button id="showVideoButton">Watch Video Instruction</button>

<!-- Video Modal -->
<div id="videoModal" class="modal">
    <span class="close" id="closeVideo">&times;</span>
    <div class="video-container">
        <video id="videoPlayer" controls>
            <source src="videos/motion.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>

<!-- CSS for Styling -->
<style>
    /* Video Button */
    #showVideoButton {
        display: block;
        margin: 20px auto;
        padding: 1px 5px;
        background-color: transparent;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 12px;
    }

    /* Video Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
    }

    .video-container {
        width: 80%;
        max-width: 600px;
    }

    .close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 2rem;
        color: white;
        cursor: pointer;
    }

    video {
        width: 100%;
        height: auto;
        border: none;
    }
</style>

<!-- JavaScript for Modal Functionality -->
<script>
    // Get the elements
    const showVideoButton = document.getElementById("showVideoButton");
    const videoModal = document.getElementById("videoModal");
    const closeVideo = document.getElementById("closeVideo");
    const videoPlayer = document.getElementById("videoPlayer");

    // Show modal when button is clicked
    showVideoButton.addEventListener("click", function() {
        videoModal.style.display = "flex";
        videoPlayer.play(); // Auto-play video when modal is shown
    });

    // Close modal when the close button is clicked
    closeVideo.addEventListener("click", function() {
        videoModal.style.display = "none";
        videoPlayer.pause(); // Pause video when modal is closed
        videoPlayer.currentTime = 0; // Reset video to start
    });

    // Close modal when clicking outside the video
    window.addEventListener("click", function(event) {
        if (event.target === videoModal) {
            videoModal.style.display = "none";
            videoPlayer.pause(); // Pause video when modal is closed
            videoPlayer.currentTime = 0; // Reset video to start
        }
    });
</script>

    </div>
    <div class="section">
        <h2>Code</h2>
        <pre><code>
#include &lt;WiFi.h&gt;
#include &lt;WebServer.h&gt;

// Define the Access Point credentials
const char* ssid = "ESP32_Flood";
const char* password = "12345678";

// Define Static IP Address
IPAddress local_IP(192, 168, 4, 1);
IPAddress gateway(192, 168, 4, 1);
IPAddress subnet(255, 255, 255, 0);

// Ultrasonic Sensor Pins
const int trigPin = 5;   // Trig pin for the ultrasonic sensor
const int echoPin = 18;  // Echo pin for the ultrasonic sensor

#define SOUND_SPEED 0.034
long duration;
float distanceCm;
float floodLevel;
float floodLevelFeet;

// Maximum flood level in centimeters
const float maxFloodLevel = 200.0;  // Change this to your sensor's maximum measurable distance (e.g., 200 cm)

WebServer server(80); // Create a web server on port 80

// Function to read the distance from the ultrasonic sensor
float readFloodLevel() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);
  
  duration = pulseIn(echoPin, HIGH);
  distanceCm = duration * SOUND_SPEED / 2;  // Convert time to distance in cm

  // Calculate flood level as a percentage (0% = no water, 100% = maximum flood level)
  floodLevel = ((maxFloodLevel - distanceCm) / maxFloodLevel) * 100;
  if (floodLevel &lt; 0) floodLevel = 0;  // Ensure no negative values
  if (floodLevel &gt; 100) floodLevel = 100;  // Ensure it doesn't go beyond 100%

  // Convert distance to feet
  floodLevelFeet = (maxFloodLevel - distanceCm) / 30.48;
  if (floodLevelFeet &lt; 0) floodLevelFeet = 0;  // Ensure no negative values

  return floodLevel;
}

// Serve the web page
void handleRoot() {
  String html = "&lt;html&gt;&lt;head&gt;&lt;title&gt;Flood Level Monitor&lt;/title&gt;";
  html += "&lt;meta name='viewport' content='width=device-width, initial-scale=1'&gt;";
  html += "&lt;style&gt;";
  html += "body { font-family: Arial, sans-serif; text-align: center; background: radial-gradient(circle, white, #00ab41); color: white; height: 100vh; display: flex; justify-content: center; align-items: center; margin: 0; }";
  html += ".container { width: 90%; max-width: 400px; background-color: white; padding: 20px; border-radius: 15px; box-shadow: 0 20px 40px 20px rgba(0, 0, 0, 0.3); text-align: center; }";
  html += "h1 { font-size: 2.5rem; color: black; margin-bottom: 20px; }";
  html += ".meter { width: 100px; height: 300px; background-color: #ddd; border-radius: 10px; position: relative; margin: 20px auto; overflow: hidden; border: 2px solid #00aaff; }";
  html += ".meter-fill { position: absolute; bottom: 0; width: 100%; background-color: #00ab41; text-align: center; color: white; font-size: 1.2rem; line-height: 30px; height: 0%; }";
  html += ".status-bar { background-color: #00ab41; padding: 10px; border-radius: 10px; font-size: 1.2rem; margin-top: 20px; }";
  html += ".alert-message { font-size: 1.5rem; color: #ff3333; font-weight: bold; margin-top: 10px; }";
  html += "&lt;/style&gt;";
  
  // Add JavaScript to refresh data
  html += "&lt;script&gt;";
  html += "setInterval(function() {";
  html += "fetch('/flood').then(function(response) {";
  html += "return response.json();";  // Expecting JSON data now
  html += "}).then(function(data) {";
  html += "document.querySelector('.meter-fill').style.height = data.floodPercentage + '%';";
  html += "document.querySelector('#floodLevelFeet').innerText = data.floodFeet.toFixed(2) + ' feet';";
  html += "});";
  html += "}, 1000);";  // Update every 1 second
  html += "&lt;/script&gt;&lt;/head&gt;&lt;body&gt;";
  
  html += "&lt;div class='container'&gt;";
  html += "&lt;h1&gt;Flood Level Monitor&lt;/h1&gt;";
  html += "&lt;div class='meter'&gt;";
  html += "&lt;div class='meter-fill'&gt;&lt;/div&gt;";
  html += "&lt;div class='lines'&gt;&lt;/div&gt;"; // Gas sensor-like lines
  html += "&lt;/div&gt;";
  
  // Display flood level in feet
  html += "&lt;div class='status-bar'&gt;";
  html += "&lt;p&gt;Current Flood Level: &lt;span id='floodLevelFeet'&gt;0.00 feet&lt;/span&gt;&lt;/p&gt;"; 
  html += "&lt;/div&gt;";

  html += "&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;";

  server.send(200, "text/html", html);
}

// Serve the flood level as JSON for AJAX requests
void handleFloodLevel() {
  readFloodLevel();  // Update the flood level
  
  // Send flood level as JSON
  String json = "{ \"floodPercentage\": " + String(floodLevel, 1) + ", \"floodFeet\": " + String(floodLevelFeet, 2) + " }";
  server.send(200, "application/json", json);
}

void setup() {
  Serial.begin(115200);
  
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);

  // Start WiFi as an access point
  WiFi.softAPConfig(local_IP, gateway, subnet);
  WiFi.softAP(ssid, password);

  Serial.println("Access Point Started");
  Serial.println(WiFi.softAPIP());

  // Start the web server
  server.on("/", handleRoot);
  server.on("/flood", handleFloodLevel);  // Endpoint for AJAX requests
  server.begin();
}

void loop() {
  server.handleClient();  // Handle web requests
}
        </code></pre><button id="copyButton">Copy Code</button>
    </div>

    <div class="section">
   <p>The code sets up a Flood Level Monitoring System using an ultrasonic sensor and an ESP32, creating an Access Point (AP) for users to monitor water levels in real-time. This system calculates flood levels as a percentage and in feet, with data displayed on a web page. Let’s break it down.

    <p><strong>Key Components and Their Roles</strong><br>
<strong>1. Libraries Included:</strong><br>
&emsp;&emsp;&emsp;•<strong><code>WiFi.h</code></strong> Executes Wi-Fi related activities, thus enabling the ESP32 to configure the formation of an Access Point for use by a user.<br>
<strong>2. WiFi Setup</strong><br>
&emsp;&emsp;&emsp;• By inserting the ESP32, an Access Point is configured with the Service Set Identifier (SSID) ESP32_Flood and the password 12345678.<br>
&emsp;&emsp;&emsp;• The ESP32 configures a static IP address for easy connection to the control interface by users.<p>

<strong>3. Ultrasonic Sensor Setup:</strong><br>
&emsp;&emsp;&emsp;• The ultrasonic sensor’s Trig and Echo pins are connected with GPIO pins 5 & and 18 respectively, to measure the distance of the water.<br>
&emsp;&emsp;&emsp;• For flood calculations the<strong><code>readFloodLevel()</code></strong>function uses sensor input as its base. Otherwise, using the speed of the released sound, the sensor determines the time taken by the reflection of the waves and calculates the distance.<br>
&emsp;&emsp;&emsp;• The flood level is represented by a percentage from the maximum flood height ensuring that viewers understand the result easily. Further, to ensure clearer understanding, the flood level is expressed in feet.<p>

<div class="button-container">
    <!-- Button to show first image -->
    <button id="showImageButton1" class="show-image-button">Ultrasonic Sensor Pinout</button>

    <!-- Button to show second image -->
    <button id="showImageButton2" class="show-image-button">ESP32 Pinout</button>
</div>

<!-- Hidden first image container -->
<div id="imageContainer1" class="hidden">
    <img src="images/ultrasonic.jpg" alt="Ultrasonic Sensor Image" style="max-width: 100%; height: auto;"><br>
    Photo Credit: The DIY Life<p>
</div>

<!-- Hidden second image container -->
<div id="imageContainer2" class="hidden">
    <img src="images/esp32.jpg" alt="ESP32 Image" style="max-width: 100%; height: auto;"><br>
    Photo Credit: Random Nerd Tutorials<p>
</div>

<!-- JavaScript to handle button clicks for each image -->
<script>
    const showImageButton1 = document.getElementById("showImageButton1");
    const imageContainer1 = document.getElementById("imageContainer1");

    const showImageButton2 = document.getElementById("showImageButton2");
    const imageContainer2 = document.getElementById("imageContainer2");

    // Toggle first image visibility
    showImageButton1.addEventListener("click", function() {
        imageContainer1.classList.toggle("hidden");
    });

    // Toggle second image visibility
    showImageButton2.addEventListener("click", function() {
        imageContainer2.classList.toggle("hidden");
    });
</script>

<!-- CSS for styling -->
<style>
    /* Center the button container */
    .button-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
        margin-top: 10px;
    }

    /* Style for buttons */
    .show-image-button {
        padding: 5px 10px;
        background-color: transparent;
        color: #7f888f;
        border: 2px solid #FF6F61;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.75rem;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 30px;
        transition: background-color 0.3s, color 0.3s;
    }

    /* Center text inside the button */
    .show-image-button:hover {
        background-color: rgba(255, 255, 255, 0.2);
        color: #00ab41;
    }

    /* Hide initially */
    .hidden {
        display: none;
    }

    /* Margin for image containers */
    #imageContainer1, #imageContainer2 {
        margin-top: 10px;
    }
</style><p>

<strong>4. Server Functions:</strong><br>
&emsp;&emsp;&emsp;• Main server functions include:<br>
&emsp;&emsp;&emsp;&emsp;&emsp;•<strong><code>handleRoot()</code></strong>Serves the main HTML page displaying flood levels as a percentage and in feet. The page includes a meter-style display that dynamically fills to represent the flood level visually.<br>
&emsp;&emsp;&emsp;&emsp;&emsp;•<strong><code>handleFloodLevel()</code></strong>Provides real-time flood level data as JSON, enabling the web interface to update dynamically using AJAX.<p>

<strong>5. Data Collection with<code>readFloodLevel()</code>:</strong><br> 
&emsp;&emsp;&emsp;• The ultrasonic data for the water level is obtained in the<strong><code>readFloodLevel()</code></strong>function of the Webots code.<br>
&emsp;&emsp;&emsp;• This allows the Mark 2 to determine the flood level in percentage with reference to maximum sensor range for example, 200 cm. Additionally, the flood level is converted to feet and limited to 0–100% for accuracy.<p>

<strong>6. Web Interface Design:</strong><br> 
&emsp;&emsp;&emsp;• The interface uses HTML and CSS to create a clean, visually appealing display.<br> 
&emsp;&emsp;&emsp;• The<strong><code>container</code></strong>div structures the page, showcasing the flood level percentage visually with a meter and numerically in feet for easy interpretation.<br> 
&emsp;&emsp;&emsp;• The<strong><code>meter</code></strong>section changes height to reflect the flood level, while the<strong><code>status-bar</code></strong>displays the exact flood level in feet.<p>

<strong>7. JavaScript and AJAX Updates:</strong><br> 
&emsp;&emsp;&emsp;• JavaScript fetches data every second from the<strong><code>/flood</code></strong>endpoint, retrieving flood levels in JSON format. This ensures the web interface stays current without needing a full page reload.<br> 
&emsp;&emsp;&emsp;• The meter fills to represent the flood level, and the background color adjusts based on the flood percentage, creating a clear and dynamic visual for users.<p>

<strong>8. The Setup<code>setup()</code>and Loop<code>loop()</code>Functions:</strong><br> 
&emsp;&emsp;&emsp;•<strong><code>setup()</code></strong>Initializes the ultrasonic sensor pins, starts the Access Point, and configures the web server.<br> 
&emsp;&emsp;&emsp;•<strong><code>loop()</code></strong>Continuously handles client requests, updates flood levels through<strong><code>readFloodLevel()</code></strong>, and provides real-time data to the web interface.<p>

    </div>
</div>

<script>
    // Toggle visibility for Set 1
    const toggleSet1 = document.getElementById('toggleSet1');
    const set1 = document.getElementById('set1');
    toggleSet1.addEventListener('click', () => {
        set1.classList.toggle('hidden'); // Toggles the "hidden" class
    });

    // Toggle visibility for Set 2
    const toggleSet2 = document.getElementById('toggleSet2');
    const set2 = document.getElementById('set2');
    toggleSet2.addEventListener('click', () => {
        set2.classList.toggle('hidden'); // Toggles the "hidden" class
    });
</script>

<h2>ASSESSMENT</h2>
<div class="box">
In this section, students are required to accomplish the following activity.<p><p>
<strong>Project Description</strong><br>
Modify the provided code to enhance its functionality by allowing the user to set a custom distance threshold (in centimeters) from the web interface. The user should be able to enter this value, and the system should update its behavior dynamically based on the new threshold.<p>
<strong>New Web Interface Feature:</strong><br>
&emsp;&emsp;&emsp;- Add an input field and button on the web interface to allow the user to set a custom distance threshold.<br>
&emsp;&emsp;&emsp;- Display the current threshold value on the web interface.<p>
<strong>Dynamic Threshold Adjustment:</strong><br>
&emsp;&emsp;&emsp;- The system should adjust the reminder activation range based on the user-defined threshold.<br>
&emsp;&emsp;&emsp;- Ensure that the buzzer and reminder message are activated only if the object is within the newly set threshold.<p>
<strong>Error Handling:</strong><br>
&emsp;&emsp;&emsp;- Ensure the input value is numeric and within a reasonable range (e.g., 5 to 400 cm). Reject invalid inputs gracefully.<br>

	<button id="key" class="toggle-button">Answer Key</button>
<!-- Section 1 -->
<div id="answerkey" class="hidden">

    <div class="section">
        <h2>Code</h2>
        <pre><code>
#include &lt;WiFi.h&gt;
#include "AdafruitIO_WiFi.h"

// Adafruit IO credentials
#define IO_USERNAME "test_user"
#define IO_KEY "aio_testkey123"

// WiFi credentials
#define WIFI_SSID "your_wifi"
#define WIFI_PASS "your_password"

// Adafruit IO instance
AdafruitIO_WiFi io(IO_USERNAME, IO_KEY, WIFI_SSID, WIFI_PASS);

// Feeds
AdafruitIO_Feed *distanceFeed = io.feed("current_distance");
AdafruitIO_Feed *thresholdFeed = io.feed("distance_threshold");
AdafruitIO_Feed *buzzerFeed = io.feed("buzzer_status");
AdafruitIO_Feed *sensorStatusFeed = io.feed("sensor_status");

// Ultrasonic Sensor Pins (Fixed)
const int trigPin = 5;  // PCB Pin D5
const int echoPin = 18; // PCB Pin D18

// Buzzer Pin (Fixed)
const int buzzerPin = 4; // PCB Pin D4

#define SOUND_SPEED 0.034
float distanceThreshold = 30.0; // Default threshold in cm
bool buzzerActive = false;

void setup() {
  Serial.begin(115200);

  // Initialize pins
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);
  pinMode(buzzerPin, OUTPUT);
  digitalWrite(buzzerPin, LOW);

  // Connect to Adafruit IO
  Serial.print("Connecting to Adafruit IO...");
  io.connect();

  // Set up Adafruit IO handlers
  thresholdFeed-&gt;onMessage(handleThresholdUpdate);

  // Wait for connection
  while (io.status() &lt; AIO_CONNECTED) {
    Serial.print(".");
    delay(500);
  }
  Serial.println("Connected!");

  // Subscribe to feeds
  thresholdFeed-&gt;get();
  sensorStatusFeed-&gt;save("Inactive"); // Initial sensor status
}

void loop() {
  io.run(); // Keep Adafruit IO connection alive
  checkDistance();
}

// Function to handle threshold updates
void handleThresholdUpdate(AdafruitIO_Data *data) {
  distanceThreshold = data-&gt;toFloat();
  Serial.println("Updated Distance Threshold: " + String(distanceThreshold) + " cm");
}

// Function to check distance and trigger buzzer
void checkDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long duration = pulseIn(echoPin, HIGH, 30000);
  float distanceCm = duration * SOUND_SPEED / 2;

  if (distanceCm &gt; 0) {
    distanceFeed-&gt;save(distanceCm); // Update distance feed

    if (distanceCm &lt; distanceThreshold && !buzzerActive) {
      buzzerActive = true;
      digitalWrite(buzzerPin, HIGH);
      buzzerFeed-&gt;save("ON");
      sensorStatusFeed-&gt;save("Activated");
      delay(5000); // Keep the buzzer ON for 5 seconds
      digitalWrite(buzzerPin, LOW);
      buzzerFeed-&gt;save("OFF");
      buzzerActive = false;
    } else {
      sensorStatusFeed-&gt;save("Inactive");
    }
  }
}

        </code></pre></div></div></div>
<script>
    // Toggle visibility for Answer Key
    const key = document.getElementById('key');
    const answerkey = document.getElementById('answerkey');
    key.addEventListener('click', () => {
        answerkey.classList.toggle('hidden'); // Toggles the "hidden" class
    });
</script>


											</div>
										</div>

								</section>

<!-- Sidebar -->
					<div id="sidebar">
						<div class="inner">

							<!-- Menu -->
								<nav id="menu">
									<header class="major">
										<h2>Menu</h2>
									</header>
									<ul>
										<li><a href="index.html">Homepage</a></li>
										<li><a href="elements.html">Module Explainer</a></li>
										<li>
											<span class="opener">Introductory Projects</span>
											<ul>
												<li><a href="io.html">Input Output</a></li>
												<li><a href="ai.html">Analog Inputs</a></li>
												<li><a href="pwm.html">PWM (Analog Output)</a></li>
												<li><a href="sws.html">Switch Web Server</a></li>
												<li><a href="rlws.html">RGB LED Web Server</a></li>
											</ul>
										</li>
										<li>
											<span class="opener">Main Projects</span>
											<ul>
												<li><a href="project-1.html">Project 1</a></li>
												<li><a href="project-2.html">Project 2</a></li>
												<li><a href="project-3.html">Project 3</a></li>
												<li><a href="project-4.html">Project 4</a></li>
												<li><a href="project-5.html">Project 5</a></li>
												<li><a href="project-6.html">Project 6</a></li>
												<li><a href="project-7.html">Project 7</a></li>
												<li><a href="project-8.html">Project 8</a></li>
												<li><a href="project-9.html">Project 9</a></li>
												<li><a href="project-10.html">Project 10</a></li>
											</ul>
										</li>
									</ul>
								</nav>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>ADVANCED IOT PROJECTS</h2>
									</header>
									<div class="mini-posts">
										<article>
											<a href="https://youtu.be/RUO44kqNP24?si=QO3qiHGQLvJSXDaD" class="image"><img src="https://i.ytimg.com/vi/RUO44kqNP24/hqdefault.jpg?sqp=-oaymwEXCNACELwBSFryq4qpAwkIARUAAIhCGAE=&rs=AOn4CLD_wUN6wdxf151rPD6UWSKlwhLK7Q" alt="" /></a>
											<p>Patient Health Monitoring System Using Raspberry Pi</p>
										</article>
										<article>
											<a href="https://youtu.be/FSqYyjZtH4g?si=9BeVl6KnJ2oD9eBl" class="image"><img src="https://i.ytimg.com/vi/FSqYyjZtH4g/hqdefault.jpg?sqp=-oaymwEbCKgBEF5IVfKriqkDDggBFQAAiEIYAXABwAEG&rs=AOn4CLCztyDAtqgoFMqVVEyold-aKebbbQ" alt="" /></a>
											<p>Women Safety Device Using Internet of Things</p>
										</article>
										<article>
											<a href="https://youtu.be/EamYfGG4Wvg?si=10C8m2DArmPMSOv3" class="image"><img src="https://i.ytimg.com/vi/EamYfGG4Wvg/hqdefault.jpg?sqp=-oaymwE1CKgBEF5IVfKriqkDKAgBFQAAiEIYAXABwAEG8AEB-AH0CYAC0AWKAgwIABABGGUgTShIMA8=&rs=AOn4CLBlZoYwXKvvyn9fsfvRhCCsItaQ3g" alt="" /></a>
											<p>A Web-Based Accident Reporting and Tracking System</p>
										</article>
									</div>
									<ul class="actions">
										<li><a href="https://youtube.com/playlist?list=PL87CgTAGz2yZ0geJ-_9HAK2u8NDMhVwFH&si=cr7ljhFT1B8GZR3-" class="button">More</a></li>
									</ul>
								</section>

							<!-- Section -->
								<section>
									<header class="major">
										<h2>Get in touch</h2>
									</header>
									<ul class="contact">
										<li class="icon solid fa-envelope"><a href="https://sscr.edu/Beta/">https://sscr.edu/Beta/</a></li>
										<li class="icon solid fa-phone">(046) 431-9405</li>
										<li class="icon solid fa-home">Manila-Cavite Road, Sta. Cruz,<br />
										Cavite City, 4100, Philippines</li>
									</ul>
								</section>

							<!-- Footer -->
								<footer id="footer">
									<p class="copyright">&copy; SSC-RdC IOT Development Board. <br>All rights reserved.
								</footer>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/copy.js"></script>

	</body>
</html>
